<html>

<head>
    <script>
        var lykke_log_deffered = {
            errors: [],
            console: [],
            console_original: {},
            methods: ['log', 'warn', 'error', 'debug', 'info', 'trace'],
            lykke_log_deffered_error_handler: function (e) {
                var target;
                e.target.tagName == "SCRIPT" || e.target.tagName == "IMG" ? target = e.target.src : null;
                e.target.tagName == "LINK" ? target = e.target.href : null

                lykke_log_deffered.errors.push(new Error(`Failed to load ${e.target.tagName} ${target}`))
            },
            console_intercept: function (method) {

                lykke_log_deffered.console_original[method] = console[method];

                console[method] = function () {
                    var message = Array.prototype.slice.apply(arguments).join(' ')
                    if (lykke_log_deffered.console_original[method]) {
                        // Do this for normal browsers
                        lykke_log_deffered.console_original[method].apply(console, arguments)
                        lykke_log_deffered.console.push({ method: method, arguments: arguments });
                    } else {
                        // Do this for IE
                        lykke_log_deffered.console_original[method](message);
                        lykke_log_deffered.console.push({ method: method, arguments: message });
                    }
                }
            }


        };
        for (var i = 0; i < lykke_log_deffered.methods.length; i++)
            lykke_log_deffered.console_intercept(lykke_log_deffered.methods[i])
        window.addEventListener('error', lykke_log_deffered.lykke_log_deffered_error_handler, true);



    </script>
    <link href="/test-error.css" rel="stylesheet">

</head>

<body>


</body>

<script src="/lykke-log/lib/lykkeLog.js"></script>
<script src="/test-error.js"></script>
<script>
    console.log("test");
    var options = {
        // endpoint: "http://localhost:5001",
        endpoint: "http://log.revolution.connecting.rs",
        batchPeriod: 1,
        minLevel: "information"
    }
    var log = new lykkeLog(options);
    log.takeOverConsole((message, method) => {
        return [`[${method.toUpperCase()}] {test}: ${message}`, "Hello"];
    });

    log.attachErrors((message, method) => {
        return [`[${method.toUpperCase()}] {test}: ${message}`, "Hello"];
    });

    setInterval(() => {
        log.info("teststring");
        //console.log("teststring");
    }, 5000)

</script>

</html>